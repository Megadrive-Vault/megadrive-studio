///////////////////////////////////////////////////////////////////////////////
// Emulator plugin definition
//
//
// 
///////////////////////////////////////////////////////////////////////////////
// Includes 
#include "include/mdShared.h"
#include "include/mdDefaultPlugin.h"

///////////////////////////////////////////////////////////////////////////////
// Constructor
///////////////////////////////////////////////////////////////////////////////

mdDefaultPlugin::mdDefaultPlugin(const wxString &filename)
{
	m_Library=NULL;
	m_Library=new wxDynamicLibrary(filename);
	m_FileName = filename;

	m_fctGetAuthor=NULL;
	m_fctGetBuildVersion=NULL;
	m_fctGetContactInfo=NULL;
	m_fctGetDescription=NULL;
	m_fctGetExt=NULL;
	m_fctGetID=NULL;

	GetSymbols();
}

///////////////////////////////////////////////////////////////////////////////
// Destructor
///////////////////////////////////////////////////////////////////////////////

mdDefaultPlugin::~mdDefaultPlugin()
{
	if(m_Library!=NULL)
	{	if(m_Library->IsLoaded()==TRUE)
			m_Library->Unload();

		delete(m_Library);
		m_Library=NULL;
	}
}

///////////////////////////////////////////////////////////////////////////////
// GetSymbols
///////////////////////////////////////////////////////////////////////////////

void mdDefaultPlugin::GetSymbols(void)
{
	if(m_Library->IsLoaded()==TRUE)
	{			
		m_fctGetAuthor=(fctGetAuthor) m_Library->GetSymbol("GetAuthor");
		m_fctGetBuildVersion=(fctGetBuildVersion) m_Library->GetSymbol("GetBuildVersion");
		m_fctGetContactInfo=(fctGetContactInfo) m_Library->GetSymbol("GetContactInfo");
		m_fctGetDescription=(fctGetDescription) m_Library->GetSymbol("GetDescription");
		m_fctGetExt=(fctGetExt) m_Library->GetSymbol("GetExt");
		m_fctGetID=(fctGetID) m_Library->GetSymbol("GetID");
	}
}

///////////////////////////////////////////////////////////////////////////////
// get Author
///////////////////////////////////////////////////////////////////////////////

wxString mdDefaultPlugin::GetAuthor(void)
{
	wxString p="";
	if(m_Library->IsLoaded()==TRUE)
	{
		if(m_fctGetAuthor)
			p.Printf("%s",m_fctGetAuthor());
	}
	return p;
}

///////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////

wxString mdDefaultPlugin::GetDescription(void)
{
	wxString p="";
	if(m_Library->IsLoaded()==TRUE)
	{
		if(m_fctGetDescription)
			p.Printf("%s",m_fctGetDescription());
	}
	return p;
}

///////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////

wxString mdDefaultPlugin::GetContactInfo(void)
{
	wxString p="";
	if(m_Library->IsLoaded()==TRUE)
	{
		if(m_fctGetContactInfo)
			p.Printf("%s",m_fctGetContactInfo());
	}
	return p;
}

///////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////

wxString mdDefaultPlugin::GetBuildVersion(void)
{
	wxString p="";
	if(m_Library->IsLoaded()==TRUE)
	{
		if(m_fctGetBuildVersion)
			p.Printf("%s",m_fctGetBuildVersion());
	}
	return p;
}

///////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////

wxString mdDefaultPlugin::GetID(void)
{
	wxString p="";
	if(m_Library->IsLoaded()==TRUE)
	{
		if(m_fctGetID)
			p.Printf("%s",m_fctGetID());
	}
	return p;
}

///////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////

wxString mdDefaultPlugin::GetExt(void)
{
	wxString p="";
	if(m_Library->IsLoaded()==TRUE)
	{
		if(m_fctGetExt)
			p.Printf("%s",m_fctGetExt());
	}
	return p;
}


///////////////////////////////////////////////////////////////////////////////